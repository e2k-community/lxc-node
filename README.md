# lxc_node

Роль предназначена для настройки LXC на хостах с ОС Эльбрус (версии 7.2).

Требования
------------

Для работы требуется:

* На сервере ОС Эльбрус версии от 7.2
* LXC версии не ниже 4.0

Переменные используемые для настройки
--------------

Для конфигурирования роли используются следующие структуры `lxc_net` и `lxc_default`, переменная `lxc_version`.

Переменная `lxc_version` - отвечает за версию устанавливаемых пакетов, по умолчанию значение `latest`.

Структура `lxc_net` отвечает за конфигурацию сети для контейнеров, в ней можно определить следующие значения:

```
lxc_net:
  enabled: <true | false>
  USE_LXC_BRIDGE: < "true" | "false" > # true, false begin in lowercase
  LXC_BRIDGE: <bridge name>
  LXC_ADDR: <bridge IP>
  LXC_NETMASK: <bridge netmask>
  LXC_NETWORK: <container network>
  LXC_DHCP_FIRST_ADDR: <first address of DCHP range>
  LXC_DHCP_LAST_ADDR: <last address of DCHP range>
  LXC_DHCP_MAX: <max adresses DCHP range>
  LXC_DHCP_CONFILE: ""
  LXC_DOMAIN: ""
```

* `enabled` - признак того, включать ли службу lxc-net ы автозапуск или нет.
* `USE_LXC_BRIDGE` - признак того использовать бридж интерфейс для организации сети контейнеров. Стоит отметить, что надо писать в нижнем регистре и в кавычках. Значение по умолчанию: `"true"`
* `LXC_BRIDGE` - имя бридж интерфейса, значение по умолчанию: `lxcbr0`
* `LXC_ADDR` - IP адрес который будет назначен на бридж интерфейс. Значение по умолчанию: `192.168.100.1`
* `LXC_NETMASK` - маска сети, которая будет назначена на бридж интерфейс. Значение по умолчанию: `255.255.255.0`.
* `LXC_NETWORK` - сеть используемая в LXC в формате: `x.x.x.x/x`. Значение по умолчанию: `192.168.103.0/24`
* `LXC_DHCP_FIRST_ADDR` - Первый адрес из диапазона выдаваемого DHCP. Значение по умолчанию: `192.168.100.2`
* `LXC_DHCP_LAST_ADDR` - Последний адрес из диапазона выдаваемого DHCP. Значение по умолчанию: `192.168.100.253`
* `LXC_DHCP_MAX` - Максимальное количество адресов выдаваемое DHCP(?). Значение по умолчанию: `253`
* `LXC_DHCP_CONFILE` - Дополнительный конфигурационный файл для dnsmasq. Значение по умолчанию - пустая строка.
* `LXC_DOMAIN` - Домен для используемый для контейнеров. Значение по умолчанию - пустая строка.

Структура `lxc_default` используется для создания конфигурации по умолчанию для контейнеров создаваемых из командной строки и с помощью роли `lxc_container`. В ней доступны следующие поля:

```
lxc_default:
  lxc_net_type: <LXC net type>
  lxc_net_link: <bridge iface name> 
  lxc_net_flags: <up | down>
  lxc_net_hwaddr: <MAC ADDRESS template>
```

* `lxc_net_type` - Тип сети контейнера, любое допустимое значение LXC. Значение по умолчанию: `veth`.
* `lxc_net_link` - Имя интерфейса с которым будет связан сетевой интерфейс контейнера. Значение по умолчанию: `lxcbr0`
* `lxc_net_flags` - Признак активирования интерфейса при старте контейнера. Значение по умолчанию: `up`
* `lxc_net_hwaddr` - Шаблон назначения MAC адресе на сетевом интерфейсе. Значение по умолчанию: `00:16:3e:xx:xx:xx`.

## Зависимости

Зависимостей нет.

## Примеры

TODO: Примеры

## License

GNU/GPL

## Автор

Stanislav V. Emets <stas@emets.su>
